<% layout('layouts/boilerplate')%>
<h1>Orders</h1>
<a href="/orders/new" class="btn btn-primary">New Order</a>
<table class="table">
	<thead>
		<tr>
			<th>Customer Name</th>
			<th>Order Date</th>
			<th>Order Type</th>
			<th>Garage Item</th>
			<th>Quantity</th>
			<th>Revenue</th>
			<th>Cost</th>
		</tr>
	</thead>
	<tbody>
		<% for(var i=0; i < orders.length; i++) { var customer = customers.find(c =>
		c.id === orders[i].customer_id); var item =
		garageItems.find(g=>g.id==orders[i].garage_item_id ); var product =
		products.find(p => p.id === item.product_id); var revenue =
		orders[i].order_type === 'sell' ? (item.retail_price) * orders[i].quantity :
		0; var cost = orders[i].order_type === 'buy' ? item.product_cost *
		orders[i].quantity : 0; %> 
		<tr>
            <% if (typeof customer !== 'undefined') { %>
			<td><%= customer.name %></td>
            <%}else{%>
			<td>NULL</td>
            <%}%>
			<td><%= orders[i].order_date %></td>
			<td><%= orders[i].order_type %></td>
			<td><%= product.name %></td>
			<td><%= orders[i].quantity %></td>
			<% if (orders[i].order_type === 'sell') { %>
			<td><%= revenue %></td>
			<% } else { %>
			<td>---</td>
			<% } %>
            <%if (orders[i].order_type === 'buy') {%>
            <td><%= cost %></td>
			<% } else { %>
			<td>---</td>
			<% } %>
			<td>
				<form
					method="post"
					action="/orders/<%= orders[i].id %>?_method=DELETE"
					onsubmit="return confirm('Are you sure you want to delete this order?')">
					<button type="submit" class="btn btn-danger">Delete</button>
				</form>
			</td>
		</tr>
		<% } %>
	</tbody>
</table>
